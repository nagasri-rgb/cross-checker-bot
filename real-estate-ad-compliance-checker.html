<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Estate Ad Compliance Checker - Meta & Google Ads</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .platform-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 30px;
            background: #f8fafc;
            border-bottom: 2px solid #e2e8f0;
        }

        .platform-btn {
            padding: 12px 30px;
            border: 2px solid #cbd5e1;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .platform-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .platform-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .platform-btn.meta.active {
            background: #1877f2;
            border-color: #1877f2;
        }

        .platform-btn.google.active {
            background: #4285f4;
            border-color: #4285f4;
        }

        .content {
            padding: 40px;
        }

        .check-section {
            margin-bottom: 40px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 25px;
            background: #fafafa;
        }

        .check-section h2 {
            font-size: 20px;
            margin-bottom: 15px;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-icon {
            width: 28px;
            height: 28px;
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #475569;
        }

        textarea, input[type="url"], input[type="file"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #cbd5e1;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            margin-bottom: 15px;
            transition: border-color 0.3s;
        }

        textarea:focus, input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        .image-preview {
            margin-top: 15px;
            max-width: 300px;
            border-radius: 8px;
            display: none;
        }

        .image-preview img {
            width: 100%;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
        }

        .check-button {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .check-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        .check-button:active {
            transform: translateY(0);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            margin-top: 40px;
            padding: 30px;
            background: white;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            display: none;
        }

        .results.show {
            display: block;
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .score-section {
            background: linear-gradient(135deg, #f8fafc 0%, #e0e7ff 100%);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 2px solid #e2e8f0;
        }

        .score-display {
            text-align: center;
            margin-bottom: 20px;
        }

        .score-circle {
            width: 180px;
            height: 180px;
            margin: 0 auto 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            font-size: 48px;
            font-weight: 700;
            border: 8px solid;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .score-circle.excellent {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            border-color: #16a34a;
            color: #16a34a;
        }

        .score-circle.good {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-color: #2563eb;
            color: #2563eb;
        }

        .score-circle.fair {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-color: #f59e0b;
            color: #f59e0b;
        }

        .score-circle.poor {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border-color: #dc2626;
            color: #dc2626;
        }

        .score-label {
            font-size: 18px;
            font-weight: 600;
            margin-top: 10px;
        }

        .score-description {
            font-size: 14px;
            color: #64748b;
            margin-top: 5px;
        }

        .score-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .score-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e2e8f0;
        }

        .score-item-value {
            font-size: 24px;
            font-weight: 700;
            color: #1e293b;
        }

        .score-item-label {
            font-size: 12px;
            color: #64748b;
            margin-top: 5px;
        }

        .result-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }

        .result-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
        }

        .result-icon.approved {
            background: #dcfce7;
            color: #16a34a;
        }

        .result-icon.rejected {
            background: #fee2e2;
            color: #dc2626;
        }

        .result-status {
            flex: 1;
        }

        .result-status h3 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .result-status.approved h3 {
            color: #16a34a;
        }

        .result-status.rejected h3 {
            color: #dc2626;
        }

        .result-status p {
            color: #64748b;
            font-size: 14px;
        }

        .violation-list {
            list-style: none;
            margin-top: 20px;
        }

        .violation-item {
            background: #fef2f2;
            border-left: 4px solid #dc2626;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .violation-item h4 {
            color: #dc2626;
            margin-bottom: 8px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .violation-item p {
            color: #475569;
            font-size: 14px;
            line-height: 1.6;
        }

        .violation-item .policy-reference {
            background: #fca5a5;
            color: #7f1d1d;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }

        .success-item {
            background: #f0fdf4;
            border-left: 4px solid #16a34a;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .success-item h4 {
            color: #16a34a;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .success-item p {
            color: #475569;
            font-size: 14px;
        }

        .warning-item {
            background: #fffbeb;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .warning-item h4 {
            color: #f59e0b;
            margin-bottom: 8px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .warning-item p {
            color: #475569;
            font-size: 14px;
            line-height: 1.6;
        }

        .category-section {
            margin-top: 30px;
        }

        .category-section h3 {
            margin-bottom: 15px;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .severity-critical {
            color: #dc2626;
        }

        .severity-high {
            color: #ea580c;
        }

        .severity-medium {
            color: #f59e0b;
        }

        .severity-low {
            color: #3b82f6;
        }

        .info-box {
            background: #f0f9ff;
            border: 2px solid #0284c7;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }

        .info-box h4 {
            color: #0284c7;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-box ul {
            margin-left: 20px;
            color: #475569;
            line-height: 1.8;
        }

        .recommendation-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .recommendation-box h4 {
            color: #92400e;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .recommendation-box ul {
            margin-left: 20px;
            color: #78350f;
            line-height: 1.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè† Real Estate Ad Compliance Checker</h1>
            <p>Comprehensive verification against Meta & Google Ads policies and Fair Housing Act</p>
        </div>

        <div class="platform-selector">
            <button class="platform-btn meta active" onclick="selectPlatform('meta')">
                <span>üìò</span> Meta Ads
            </button>
            <button class="platform-btn google" onclick="selectPlatform('google')">
                <span>üîç</span> Google Ads
            </button>
            <button class="platform-btn both" onclick="selectPlatform('both')">
                <span>üîÑ</span> Both Platforms
            </button>
        </div>

        <div class="content">
            <div class="check-section">
                <h2><span class="section-icon">üìù</span>Ad Text / Copy</h2>
                <label for="adText">Enter your ad headline and description:</label>
                <textarea id="adText" placeholder="Example: Luxury 3BHK Apartments in Downtown. Special offer - 20% off! Low EMI options available. Contact us now!"></textarea>
            </div>

            <div class="check-section">
                <h2><span class="section-icon">üñºÔ∏è</span>Ad Image</h2>
                <label for="adImage">Upload your ad image:</label>
                <input type="file" id="adImage" accept="image/*" onchange="previewImage(event)">
                <div class="image-preview" id="imagePreview">
                    <img id="previewImg" src="" alt="Preview">
                </div>
            </div>

            <div class="check-section">
                <h2><span class="section-icon">üåê</span>Landing Page URL</h2>
                <label for="landingPage">Enter your landing page URL:</label>
                <input type="url" id="landingPage" placeholder="https://example.com/property-listing">
            </div>

            <button class="check-button" onclick="checkCompliance()">
                üîç Check Compliance & Calculate Score
            </button>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p id="loadingText">Analyzing your campaign against platform guidelines...</p>
                <p id="loadingSubtext" style="font-size: 14px; color: #64748b; margin-top: 10px;"></p>
            </div>

            <div class="results" id="results"></div>
        </div>
    </div>

    <script>
        let selectedPlatform = 'meta';

        // Comprehensive policy database based on actual Meta and Google requirements
        const POLICIES = {
            // Fair Housing Act - Protected Classes (applies to both platforms)
            fairHousing: {
                protectedClasses: ['race', 'color', 'religion', 'national origin', 'sex', 'disability', 'familial status'],
                prohibitedTerms: [
                    // Family status
                    'no kids', 'no children', 'adults only', 'mature individuals', 'singles only', 
                    'couples only', 'perfect for newlyweds', 'family only', 'no students', 
                    'ideal for retirees', 'young professionals', 'empty nesters', 'perfect for families with children',
                    // Marital status
                    'married couples', 'single persons', 'divorced', 'widowed',
                    // Age
                    'senior', 'elderly', 'young', 'older persons',
                    // Sex/Gender
                    'men only', 'women only', 'male', 'female tenants',
                    // Religion
                    'christian', 'muslim', 'jewish', 'hindu', 'no atheists', 'religious',
                    // National origin/Race
                    'caucasian', 'african american', 'asian', 'hispanic', 'latino', 'white', 'black',
                    'english speakers only', 'speaks english', 'american citizens',
                    // Disability
                    'no wheelchairs', 'able-bodied', 'physically fit', 'no disabled',
                    // Other discriminatory
                    'exclusive', 'restricted', 'private community', 'select clientele'
                ]
            },
            
            // Meta-specific policies
            meta: {
                specialAdCategory: {
                    required: true,
                    name: 'Housing',
                    restrictions: {
                        age: '18-65+ (locked)',
                        gender: 'All genders must be included',
                        location: 'Minimum 15-mile (US) or 10-mile (Europe) radius',
                        zipCode: 'Prohibited',
                        detailedTargeting: 'Removed',
                        lookalike: 'Disabled (replaced with Special Ad Audiences)'
                    }
                },
                imageText: {
                    limit: 20, // percentage
                    description: 'Image text should not exceed 20% of image area'
                },
                capitalization: {
                    maxConsecutiveCaps: 3,
                    description: 'Excessive use of capital letters is limited'
                },
                prohibitedContent: [
                    'Before/after images',
                    'Non-existent functionality',
                    'Shocking content',
                    'Sensational claims without proof'
                ]
            },
            
            // Google Ads-specific policies
            google: {
                httpsRequired: true,
                prohibitedTargeting: {
                    gender: 'Must target all genders',
                    age: 'Cannot exclude age groups',
                    parentalStatus: 'Prohibited',
                    maritalStatus: 'Prohibited',
                    zipCode: 'Prohibited (use radius or city instead)'
                },
                allowedTargeting: [
                    'City, County, State',
                    'Radius targeting',
                    'Household income',
                    'Homeownership status',
                    'In-Market audiences'
                ],
                landingPageRequirements: {
                    privacyPolicy: 'Required',
                    contactInfo: 'Required',
                    loadTime: '< 3 seconds',
                    mobileResponsive: 'Required'
                }
            }
        };

        function selectPlatform(platform) {
            selectedPlatform = platform;
            document.querySelectorAll('.platform-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.platform-btn').classList.add('active');
        }

        function previewImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('imagePreview').style.display = 'block';
                }
                reader.readAsDataURL(file);
            }
        }

        async function checkCompliance() {
            const adText = document.getElementById('adText').value;
            const landingPage = document.getElementById('landingPage').value;
            const adImage = document.getElementById('adImage').files[0];

            if (!adText && !landingPage && !adImage) {
                alert('Please provide at least one input to check!');
                return;
            }

            // Show loading
            document.getElementById('loading').classList.add('show');
            document.getElementById('results').classList.remove('show');
            document.getElementById('loadingText').textContent = 'Analyzing your campaign against platform guidelines...';
            document.getElementById('loadingSubtext').textContent = '';

            // Fetch and analyze landing page if provided
            let landingPageContent = null;
            if (landingPage) {
                try {
                    document.getElementById('loadingSubtext').textContent = 'üåê Fetching and analyzing landing page content...';
                    landingPageContent = await fetchLandingPage(landingPage);
                } catch (error) {
                    console.error('Error fetching landing page:', error);
                }
            }

            // Analyze compliance
            setTimeout(() => {
                const results = analyzeCompliance(adText, landingPage, adImage, landingPageContent);
                displayResults(results);
                document.getElementById('loading').classList.remove('show');
            }, 1000);
        }

        async function fetchLandingPage(url) {
            try {
                const response = await fetch(url, {
                    mode: 'cors',
                    credentials: 'omit'
                });
                
                if (!response.ok) {
                    throw new Error('Failed to fetch page');
                }
                
                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                return {
                    success: true,
                    title: doc.title || '',
                    metaDescription: doc.querySelector('meta[name="description"]')?.content || '',
                    headings: Array.from(doc.querySelectorAll('h1, h2, h3')).map(h => h.textContent.trim()),
                    bodyText: doc.body?.textContent || '',
                    hasContactForm: doc.querySelector('form') !== null,
                    hasPhoneNumber: /\+?[\d\s\-\(\)]{10,}/.test(doc.body?.textContent || ''),
                    hasEmail: /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/.test(doc.body?.textContent || ''),
                    hasPrivacyPolicy: /privacy\s*policy/i.test(doc.body?.textContent || ''),
                    hasTerms: /terms\s*(and|&)?\s*conditions|terms\s*of\s*(use|service)/i.test(doc.body?.textContent || ''),
                    images: Array.from(doc.querySelectorAll('img')).length,
                    forms: Array.from(doc.querySelectorAll('form')).length,
                    links: Array.from(doc.querySelectorAll('a')).length
                };
            } catch (error) {
                return await fetchViaIframe(url);
            }
        }

        async function fetchViaIframe(url) {
            return new Promise((resolve) => {
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = url;
                
                let resolved = false;
                
                iframe.onload = () => {
                    if (resolved) return;
                    resolved = true;
                    
                    try {
                        const doc = iframe.contentDocument || iframe.contentWindow.document;
                        
                        const content = {
                            success: true,
                            title: doc.title || '',
                            metaDescription: doc.querySelector('meta[name="description"]')?.content || '',
                            headings: Array.from(doc.querySelectorAll('h1, h2, h3')).map(h => h.textContent.trim()),
                            bodyText: doc.body?.textContent || '',
                            hasContactForm: doc.querySelector('form') !== null,
                            hasPhoneNumber: /\+?[\d\s\-\(\)]{10,}/.test(doc.body?.textContent || ''),
                            hasEmail: /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/.test(doc.body?.textContent || ''),
                            hasPrivacyPolicy: /privacy\s*policy/i.test(doc.body?.textContent || ''),
                            hasTerms: /terms\s*(and|&)?\s*conditions|terms\s*of\s*(use|service)/i.test(doc.body?.textContent || ''),
                            images: Array.from(doc.querySelectorAll('img')).length,
                            forms: Array.from(doc.querySelectorAll('form')).length,
                            links: Array.from(doc.querySelectorAll('a')).length
                        };
                        
                        document.body.removeChild(iframe);
                        resolve(content);
                    } catch (e) {
                        document.body.removeChild(iframe);
                        resolve({
                            success: false,
                            corsBlocked: true,
                            message: 'Unable to access page content due to CORS restrictions'
                        });
                    }
                };
                
                iframe.onerror = () => {
                    if (resolved) return;
                    resolved = true;
                    document.body.removeChild(iframe);
                    resolve({
                        success: false,
                        error: true,
                        message: 'Failed to load landing page'
                    });
                };
                
                setTimeout(() => {
                    if (resolved) return;
                    resolved = true;
                    try {
                        document.body.removeChild(iframe);
                    } catch (e) {}
                    resolve({
                        success: false,
                        timeout: true,
                        message: 'Page load timeout (>10 seconds)'
                    });
                }, 10000);
                
                document.body.appendChild(iframe);
            });
        }

        function analyzeCompliance(adText, landingPage, imageFile, landingPageContent) {
            const violations = [];
            const warnings = [];
            const passed = [];
            let totalChecks = 0;
            let passedChecks = 0;
            let criticalViolations = 0;

            // Check text compliance
            if (adText) {
                const textResults = checkTextCompliance(adText, selectedPlatform);
                violations.push(...textResults.violations);
                warnings.push(...textResults.warnings);
                passed.push(...textResults.passed);
                totalChecks += textResults.totalChecks;
                passedChecks += textResults.passedChecks;
                criticalViolations += textResults.criticalViolations;
            }

            // Check landing page
            if (landingPage) {
                const urlResults = checkLandingPageCompliance(landingPage, selectedPlatform, landingPageContent);
                violations.push(...urlResults.violations);
                warnings.push(...urlResults.warnings);
                passed.push(...urlResults.passed);
                totalChecks += urlResults.totalChecks;
                passedChecks += urlResults.passedChecks;
                criticalViolations += urlResults.criticalViolations;
            }

            // Check image
            if (imageFile) {
                const imageResults = checkImageCompliance(imageFile, selectedPlatform);
                violations.push(...imageResults.violations);
                warnings.push(...imageResults.warnings);
                passed.push(...imageResults.passed);
                totalChecks += imageResults.totalChecks;
                passedChecks += imageResults.passedChecks;
                criticalViolations += imageResults.criticalViolations;
            }

            // Calculate score (0-100)
            const baseScore = totalChecks > 0 ? Math.round((passedChecks / totalChecks) * 100) : 0;
            
            // Penalties
            let score = baseScore;
            score -= (criticalViolations * 15); // Each critical violation -15 points
            score -= (warnings.length * 5); // Each warning -5 points
            score = Math.max(0, Math.min(100, score)); // Clamp between 0-100

            return {
                score: score,
                approved: criticalViolations === 0 && violations.length === 0,
                violations,
                warnings,
                passed,
                totalChecks,
                passedChecks,
                criticalViolations,
                platform: selectedPlatform
            };
        }

        function checkTextCompliance(text, platform) {
            const violations = [];
            const warnings = [];
            const passed = [];
            let totalChecks = 0;
            let passedChecks = 0;
            let criticalViolations = 0;

            const lowerText = text.toLowerCase();

            // CRITICAL: Fair Housing Act - Discriminatory Language
            totalChecks++;
            const foundDiscriminatory = POLICIES.fairHousing.prohibitedTerms.filter(term => {
                return lowerText.includes(term.toLowerCase());
            });
            
            if (foundDiscriminatory.length > 0) {
                criticalViolations++;
                violations.push({
                    title: 'üö® Fair Housing Act Violation - Discriminatory Language',
                    description: `CRITICAL: Found prohibited discriminatory terms: "${foundDiscriminatory.join('", "')}". This violates the Fair Housing Act and both Meta and Google Ads policies. Protected classes include: race, color, religion, national origin, sex, disability, and familial status. This will result in immediate ad rejection and possible legal action.`,
                    severity: 'critical',
                    policy: 'Fair Housing Act ¬ß 3604(c)',
                    action: 'Remove all discriminatory language immediately and focus on property features, not tenant characteristics.'
                });
            } else {
                passedChecks++;
                passed.push({
                    title: '‚úÖ No Discriminatory Language Detected',
                    description: 'Ad text complies with Fair Housing Act requirements - no prohibited discriminatory terms found.'
                });
            }

            // Meta: Special Ad Category Declaration
            if (platform === 'meta' || platform === 'both') {
                totalChecks++;
                passedChecks++; // They need to do this in the platform
                passed.push({
                    title: '‚ö†Ô∏è Meta Special Ad Category Declaration Required',
                    description: 'Remember to declare your ad under "Housing" special ad category in Meta Ads Manager. Failure to do this will result in ad rejection. Age: 18-65+, All genders required, Min 15-mile radius (US) / 10-mile (Europe).'
                });
            }

            // Excessive Capitalization (Meta)
            if (platform === 'meta' || platform === 'both') {
                totalChecks++;
                const capsWords = text.split(' ').filter(word => 
                    word === word.toUpperCase() && word.length > 1 && /[A-Z]/.test(word)
                );
                if (capsWords.length > POLICIES.meta.capitalization.maxConsecutiveCaps) {
                    violations.push({
                        title: 'Excessive Capitalization (Meta)',
                        description: `Found ${capsWords.length} all-caps words. Meta limits excessive capitalization to prevent appearing too promotional. Reduce to ${POLICIES.meta.capitalization.maxConsecutiveCaps} or fewer all-caps words.`,
                        severity: 'high',
                        policy: 'Meta Advertising Standards - Text in Images'
                    });
                } else {
                    passedChecks++;
                    passed.push({
                        title: '‚úÖ Appropriate Capitalization',
                        description: 'Text uses appropriate capitalization (not excessive).'
                    });
                }
            }

            // Unsubstantiated Claims
            totalChecks++;
            const superlatives = ['best', 'cheapest', 'lowest price', 'guaranteed returns', 'highest returns', '#1', 'number one', 'top rated'];
            const foundSuperlatives = superlatives.filter(term => lowerText.includes(term));
            if (foundSuperlatives.length > 0) {
                warnings.push({
                    title: 'Unsubstantiated Claims',
                    description: `Claims like "${foundSuperlatives.join('", "')}" require proof and substantiation. Ensure you have documentation to back these claims, or they may be flagged as misleading.`,
                    severity: 'high',
                    policy: 'Both platforms - Misleading Content'
                });
            } else {
                passedChecks++;
            }

            // Financial/Credit terms disclosure
            totalChecks++;
            if (/emi|loan|finance|mortgage|credit|interest|apr|down payment/i.test(text)) {
                warnings.push({
                    title: 'Financial Terms Require Full Disclosure',
                    description: 'Your ad mentions financing/credit terms (EMI, loan, etc.). You must provide complete disclosure of all terms, rates, and conditions in compliance with Truth in Lending Act. Include representative APR, term length, and any conditions.',
                    severity: 'high',
                    policy: 'TILA / Financial Product Advertising'
                });
            } else {
                passedChecks++;
            }

            // Google: Government affiliation claims
            if (platform === 'google' || platform === 'both') {
                totalChecks++;
                if (/government|official|approved by|certified by government/i.test(text)) {
                    violations.push({
                        title: 'Misleading Government Affiliation (Google)',
                        description: 'Ad suggests government affiliation or approval which is prohibited without proper authorization and documentation.',
                        severity: 'critical',
                        policy: 'Google Ads - Misrepresentation'
                    });
                    criticalViolations++;
                } else {
                    passedChecks++;
                }
            }

            // Clear call-to-action check
            totalChecks++;
            const hasCTA = /contact|call|visit|book|register|enquire|inquire|schedule|apply|learn more/i.test(text);
            if (hasCTA) {
                passedChecks++;
                passed.push({
                    title: '‚úÖ Clear Call-to-Action Present',
                    description: 'Ad contains a clear call-to-action which improves user experience and conversion.'
                });
            } else {
                warnings.push({
                    title: 'No Clear Call-to-Action',
                    description: 'Consider adding a clear CTA like "Contact Now", "Schedule Tour", "Learn More" to improve ad performance.',
                    severity: 'low'
                });
            }

            return { violations, warnings, passed, totalChecks, passedChecks, criticalViolations };
        }

        function checkLandingPageCompliance(url, platform, pageContent) {
            const violations = [];
            const warnings = [];
            const passed = [];
            let totalChecks = 0;
            let passedChecks = 0;
            let criticalViolations = 0;

            try {
                const urlObj = new URL(url);

                // HTTPS requirement (critical for Google)
                totalChecks++;
                if (urlObj.protocol !== 'https:') {
                    if (platform === 'google' || platform === 'both') {
                        criticalViolations++;
                        violations.push({
                            title: 'üö® Insecure Landing Page - HTTPS Required',
                            description: 'Google Ads REQUIRES HTTPS for all landing pages. Your URL uses HTTP which will result in immediate ad rejection. This is non-negotiable.',
                            severity: 'critical',
                            policy: 'Google Ads - Landing Page Requirements',
                            action: 'Install SSL certificate and use HTTPS protocol.'
                        });
                    } else {
                        warnings.push({
                            title: 'Insecure Connection (HTTP)',
                            description: 'Using HTTPS is strongly recommended for security and user trust. Modern browsers warn users about non-HTTPS sites.',
                            severity: 'high'
                        });
                    }
                } else {
                    passedChecks++;
                    passed.push({
                        title: '‚úÖ Secure HTTPS Connection',
                        description: 'Landing page uses HTTPS protocol (required by Google, recommended by Meta).'
                    });
                }

                // Analyze page content if available
                if (pageContent && pageContent.success) {
                    // Contact Information (REQUIRED)
                    totalChecks++;
                    if (!pageContent.hasPhoneNumber && !pageContent.hasEmail && !pageContent.hasContactForm) {
                        criticalViolations++;
                        violations.push({
                            title: 'üö® Missing Contact Information',
                            description: 'Landing page MUST have clear contact information (phone, email, or contact form). Both Meta and Google require easy ways for users to contact advertisers. This is a critical requirement.',
                            severity: 'critical',
                            policy: 'Both platforms - Transparency Requirements',
                            action: 'Add visible phone number, email, and/or contact form.'
                        });
                    } else {
                        passedChecks++;
                        let contactMethods = [];
                        if (pageContent.hasPhoneNumber) contactMethods.push('phone');
                        if (pageContent.hasEmail) contactMethods.push('email');
                        if (pageContent.hasContactForm) contactMethods.push('contact form');
                        
                        passed.push({
                            title: '‚úÖ Contact Information Present',
                            description: `Landing page includes: ${contactMethods.join(', ')}.`
                        });
                    }

                    // Privacy Policy (REQUIRED for Google)
                    totalChecks++;
                    if (!pageContent.hasPrivacyPolicy) {
                        if (platform === 'google' || platform === 'both') {
                            criticalViolations++;
                            violations.push({
                                title: 'üö® Missing Privacy Policy (Google Required)',
                                description: 'Google Ads REQUIRES a visible privacy policy link on landing pages, especially for housing ads that collect user data. This is mandatory under GDPR and CCPA compliance.',
                                severity: 'critical',
                                policy: 'Google Ads - Privacy Policy Requirement',
                                action: 'Add privacy policy page and link prominently in footer.'
                            });
                        } else {
                            warnings.push({
                                title: 'Privacy Policy Not Detected',
                                description: 'Privacy policy is highly recommended and required if collecting any user data (forms, cookies, etc.).',
                                severity: 'high',
                                policy: 'GDPR / CCPA Compliance'
                            });
                        }
                    } else {
                        passedChecks++;
                        passed.push({
                            title: '‚úÖ Privacy Policy Found',
                            description: 'Landing page includes privacy policy link (required by Google).'
                        });
                    }

                    // Content Quality
                    totalChecks++;
                    const wordCount = pageContent.bodyText.split(/\s+/).filter(w => w.length > 0).length;
                    if (wordCount < 100) {
                        warnings.push({
                            title: 'Thin Content',
                            description: `Landing page has very little content (${wordCount} words). Add comprehensive property details, amenities, location information, pricing, and terms to improve quality score.`,
                            severity: 'high'
                        });
                    } else if (wordCount < 300) {
                        warnings.push({
                            title: 'Limited Content',
                            description: `Landing page has minimal content (${wordCount} words). Consider adding more details for better user experience and SEO.`,
                            severity: 'medium'
                        });
                    } else {
                        passedChecks++;
                        passed.push({
                            title: '‚úÖ Adequate Content',
                            description: `Landing page has ${wordCount} words of content.`
                        });
                    }

                    // Images check
                    totalChecks++;
                    if (pageContent.images === 0) {
                        warnings.push({
                            title: 'No Property Images',
                            description: 'Real estate landing pages should include high-quality images of the property. Visual content significantly improves conversion rates.',
                            severity: 'high'
                        });
                    } else if (pageContent.images < 3) {
                        warnings.push({
                            title: 'Few Property Images',
                            description: `Only ${pageContent.images} image(s) found. Real estate pages typically perform better with 5-10 high-quality property images.`,
                            severity: 'medium'
                        });
                    } else {
                        passedChecks++;
                        passed.push({
                            title: '‚úÖ Property Images Present',
                            description: `Landing page contains ${pageContent.images} images.`
                        });
                    }

                    // CRITICAL: Discriminatory content on landing page
                    totalChecks++;
                    const bodyTextLower = pageContent.bodyText.toLowerCase();
                    const foundDiscriminatory = POLICIES.fairHousing.prohibitedTerms.filter(term => 
                        bodyTextLower.includes(term.toLowerCase())
                    );
                    
                    if (foundDiscriminatory.length > 0) {
                        criticalViolations++;
                        violations.push({
                            title: 'üö® Discriminatory Content on Landing Page',
                            description: `CRITICAL: Landing page contains Fair Housing Act violations: "${foundDiscriminatory.join('", "')}". This applies even though it's not in the ad itself - landing pages must also comply with Fair Housing Act.`,
                            severity: 'critical',
                            policy: 'Fair Housing Act ¬ß 3604(c)',
                            action: 'Remove all discriminatory language from landing page immediately.'
                        });
                    } else {
                        passedChecks++;
                        passed.push({
                            title: '‚úÖ No Discriminatory Content on Page',
                            description: 'Landing page content complies with Fair Housing Act requirements.'
                        });
                    }

                    // Pricing information
                    totalChecks++;
                    const hasPricing = /‚Çπ|rs\.?|inr|price|cost|starting from|\d+\s*lac|\d+\s*crore|\$\d+|price\s*range/i.test(pageContent.bodyText);
                    if (!hasPricing) {
                        warnings.push({
                            title: 'No Pricing Information',
                            description: 'Landing page should clearly display pricing or price range for transparency and better lead quality.',
                            severity: 'medium'
                        });
                    } else {
                        passedChecks++;
                        passed.push({
                            title: '‚úÖ Pricing Information Found',
                            description: 'Landing page includes pricing details.'
                        });
                    }

                } else if (pageContent && pageContent.timeout) {
                    totalChecks++;
                    criticalViolations++;
                    violations.push({
                        title: 'üö® Page Load Timeout',
                        description: 'Landing page took >10 seconds to load. Both Meta and Google penalize slow pages. Target load time: <3 seconds. Optimize images, reduce scripts, use CDN, enable caching.',
                        severity: 'critical',
                        policy: 'Both platforms - Page Experience',
                        action: 'Use Google PageSpeed Insights to identify and fix performance issues.'
                    });
                } else if (pageContent && pageContent.error) {
                    totalChecks++;
                    criticalViolations++;
                    violations.push({
                        title: 'üö® Landing Page Not Accessible',
                        description: 'Unable to load landing page. Your ad will be rejected if the destination URL is not accessible. Verify the URL is correct and server is online.',
                        severity: 'critical',
                        policy: 'Both platforms - Functional Landing Page',
                        action: 'Verify URL and ensure website is online and accessible.'
                    });
                } else if (pageContent && pageContent.corsBlocked) {
                    totalChecks += 5; // Multiple checks we couldn't perform
                    passedChecks += 2; // Assume some basics are OK
                    warnings.push({
                        title: 'Limited Page Analysis (CORS Restricted)',
                        description: 'Could not fully analyze landing page due to security restrictions. Manually verify: (1) Contact info visible, (2) Privacy policy exists, (3) No discriminatory language, (4) Page loads <3 seconds, (5) Mobile responsive.',
                        severity: 'medium'
                    });
                }

                // Mobile responsiveness reminder
                totalChecks++;
                warnings.push({
                    title: 'Mobile Responsiveness Required',
                    description: 'Ensure landing page is fully responsive. Over 70% of real estate searches are on mobile devices. Test on multiple devices and screen sizes.',
                    severity: 'high',
                    policy: 'Both platforms - Mobile Experience'
                });

            } catch (e) {
                totalChecks++;
                criticalViolations++;
                violations.push({
                    title: 'üö® Invalid URL Format',
                    description: 'The provided URL is not valid. Include protocol (https://), domain, and path. Example: https://example.com/property',
                    severity: 'critical',
                    action: 'Enter a complete, valid URL with https:// protocol.'
                });
            }

            return { violations, warnings, passed, totalChecks, passedChecks, criticalViolations };
        }

        function checkImageCompliance(imageFile, platform) {
            const violations = [];
            const warnings = [];
            const passed = [];
            let totalChecks = 0;
            let passedChecks = 0;
            let criticalViolations = 0;

            // File size check
            totalChecks++;
            const maxSize = 5 * 1024 * 1024; // 5MB
            if (imageFile.size > maxSize) {
                warnings.push({
                    title: 'Large Image File',
                    description: `Image is ${Math.round(imageFile.size / 1024 / 1024)}MB. Files over 5MB may slow page load. Compress to 2MB or less for optimal performance.`,
                    severity: 'medium'
                });
            } else {
                passedChecks++;
            }

            // File type check
            totalChecks++;
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
            if (!validTypes.includes(imageFile.type)) {
                violations.push({
                    title: 'Unsupported Image Format',
                    description: `Image format ${imageFile.type} may not be supported. Use JPG, PNG, or WebP format.`,
                    severity: 'high',
                    policy: 'Both platforms - Image Requirements'
                });
            } else {
                passedChecks++;
                passed.push({
                    title: '‚úÖ Valid Image Format',
                    description: `Image format (${imageFile.type}) is supported.`
                });
            }

            // Meta-specific: Image text policy
            if (platform === 'meta' || platform === 'both') {
                totalChecks++;
                warnings.push({
                    title: 'Meta Image Text Policy (20% Rule)',
                    description: 'Meta limits text in images to 20% of image area. Ads with excessive text may have limited delivery or be rejected. Use Meta\'s Text Overlay Tool to check your image before uploading.',
                    severity: 'high',
                    policy: 'Meta - Text in Images'
                });

                totalChecks++;
                warnings.push({
                    title: 'Meta Image Content Requirements',
                    description: 'Verify image does NOT contain: (1) Before/after comparisons, (2) Shocking/unexpected content, (3) Non-existent functionality, (4) Misleading representations. Images must accurately represent the actual property.',
                    severity: 'high',
                    policy: 'Meta - Prohibited Content'
                });
            }

            // Google-specific
            if (platform === 'google' || platform === 'both') {
                totalChecks++;
                warnings.push({
                    title: 'Google Image Quality Requirements',
                    description: 'Ensure image: (1) Is clear and high-resolution (min 1200x628px), (2) Represents actual property, (3) No prohibited content (weapons, drugs), (4) Minimal filters/editing.',
                    severity: 'medium',
                    policy: 'Google Ads - Image Quality'
                });
            }

            // Best practices
            totalChecks++;
            passedChecks++;
            passed.push({
                title: '‚úÖ Image Best Practices',
                description: 'Recommended: 1200x628px resolution, landscape orientation, actual property photos, good lighting, no watermarks except property branding.'
            });

            return { violations, warnings, passed, totalChecks, passedChecks, criticalViolations };
        }

        function displayResults(results) {
            const resultsDiv = document.getElementById('results');
            const isApproved = results.criticalViolations === 0 && results.violations.length === 0;
            
            let platformName = results.platform === 'both' ? 'Meta & Google Ads' : 
                              results.platform === 'meta' ? 'Meta Ads' : 'Google Ads';

            // Determine score grade
            let scoreGrade, scoreClass, scoreDescription;
            if (results.score >= 90) {
                scoreGrade = 'Excellent';
                scoreClass = 'excellent';
                scoreDescription = 'Ready to launch! Campaign meets all requirements.';
            } else if (results.score >= 75) {
                scoreGrade = 'Good';
                scoreClass = 'good';
                scoreDescription = 'Minor improvements recommended before launch.';
            } else if (results.score >= 60) {
                scoreGrade = 'Fair';
                scoreClass = 'fair';
                scoreDescription = 'Address warnings to improve approval chances.';
            } else {
                scoreGrade = 'Poor';
                scoreClass = 'poor';
                scoreDescription = 'Critical issues must be fixed before launch.';
            }

            let html = `
                <div class="score-section">
                    <div class="score-display">
                        <div class="score-circle ${scoreClass}">
                            <div>
                                <div>${results.score}</div>
                                <div style="font-size: 14px; font-weight: 400;">/ 100</div>
                            </div>
                        </div>
                        <div class="score-label">${scoreGrade} Compliance Score</div>
                        <div class="score-description">${scoreDescription}</div>
                    </div>
                    
                    <div class="score-breakdown">
                        <div class="score-item">
                            <div class="score-item-value">${results.passedChecks}/${results.totalChecks}</div>
                            <div class="score-item-label">Checks Passed</div>
                        </div>
                        <div class="score-item">
                            <div class="score-item-value" style="color: #dc2626;">${results.criticalViolations}</div>
                            <div class="score-item-label">Critical Issues</div>
                        </div>
                        <div class="score-item">
                            <div class="score-item-value" style="color: #ea580c;">${results.violations.length - results.criticalViolations}</div>
                            <div class="score-item-label">High Priority</div>
                        </div>
                        <div class="score-item">
                            <div class="score-item-value" style="color: #f59e0b;">${results.warnings.length}</div>
                            <div class="score-item-label">Warnings</div>
                        </div>
                        <div class="score-item">
                            <div class="score-item-value" style="color: #16a34a;">${results.passed.length}</div>
                            <div class="score-item-label">Passed</div>
                        </div>
                    </div>
                </div>

                <div class="result-header">
                    <div class="result-icon ${isApproved ? 'approved' : 'rejected'}">
                        ${isApproved ? '‚úì' : '‚úó'}
                    </div>
                    <div class="result-status ${isApproved ? 'approved' : 'rejected'}">
                        <h3>${isApproved ? 'Campaign Likely to Be Approved ‚ú®' : 'Campaign Will Be Rejected ‚ö†Ô∏è'}</h3>
                        <p>Analysis based on ${platformName} policies and Fair Housing Act</p>
                    </div>
                </div>
            `;

            // Critical violations
            if (results.violations.filter(v => v.severity === 'critical').length > 0) {
                html += '<div class="category-section">';
                html += '<h3 class="severity-critical">üö® Critical Violations (MUST Fix Immediately)</h3>';
                html += '<p style="color: #dc2626; margin-bottom: 15px; font-weight: 600;">These issues will result in immediate ad rejection and may have legal consequences.</p>';
                html += '<ul class="violation-list">';
                results.violations.filter(v => v.severity === 'critical').forEach(violation => {
                    html += `
                        <li class="violation-item">
                            <h4>
                                ${violation.title}
                                ${violation.policy ? `<span class="policy-reference">${violation.policy}</span>` : ''}
                            </h4>
                            <p>${violation.description}</p>
                            ${violation.action ? `<p style="margin-top: 10px; font-weight: 600; color: #7f1d1d;">Action Required: ${violation.action}</p>` : ''}
                        </li>
                    `;
                });
                html += '</ul></div>';
            }

            // High priority violations
            if (results.violations.filter(v => v.severity === 'high').length > 0) {
                html += '<div class="category-section">';
                html += '<h3 class="severity-high">‚ö†Ô∏è High Priority Issues (Fix Before Launch)</h3>';
                html += '<ul class="violation-list">';
                results.violations.filter(v => v.severity === 'high').forEach(violation => {
                    html += `
                        <li class="violation-item" style="background: #fff7ed; border-left-color: #ea580c;">
                            <h4 style="color: #ea580c;">
                                ${violation.title}
                                ${violation.policy ? `<span class="policy-reference" style="background: #fdba74; color: #7c2d12;">${violation.policy}</span>` : ''}
                            </h4>
                            <p>${violation.description}</p>
                            ${violation.action ? `<p style="margin-top: 10px; font-weight: 600; color: #7c2d12;">Action: ${violation.action}</p>` : ''}
                        </li>
                    `;
                });
                html += '</ul></div>';
            }

            // Warnings
            if (results.warnings.length > 0) {
                html += '<div class="category-section">';
                html += '<h3 class="severity-medium">‚ö†Ô∏è Warnings (Recommended to Fix)</h3>';
                html += '<p style="color: #92400e; margin-bottom: 15px;">These may not cause immediate rejection but could limit performance or cause issues.</p>';
                html += '<ul class="violation-list">';
                results.warnings.forEach(warning => {
                    html += `
                        <li class="warning-item">
                            <h4>
                                ${warning.title}
                                ${warning.policy ? `<span class="policy-reference" style="background: #fbbf24; color: #78350f;">${warning.policy}</span>` : ''}
                            </h4>
                            <p>${warning.description}</p>
                        </li>
                    `;
                });
                html += '</ul></div>';
            }

            // Passed checks
            if (results.passed.length > 0) {
                html += '<div class="category-section">';
                html += '<h3 style="color: #16a34a;">‚úÖ Passed Compliance Checks</h3>';
                html += '<ul class="violation-list">';
                results.passed.forEach(pass => {
                    html += `
                        <li class="success-item">
                            <h4>${pass.title}</h4>
                            <p>${pass.description}</p>
                        </li>
                    `;
                });
                html += '</ul></div>';
            }

            // Recommendations
            if (!isApproved || results.warnings.length > 0) {
                html += `
                    <div class="recommendation-box">
                        <h4>üìã Next Steps & Recommendations</h4>
                        <ul>
                            ${results.criticalViolations > 0 ? '<li><strong>URGENT:</strong> Fix all critical violations before attempting to run this campaign. These will result in immediate rejection and may have legal consequences.</li>' : ''}
                            ${results.violations.length > 0 ? '<li>Address all high-priority issues to ensure ad approval and compliance.</li>' : ''}
                            ${results.warnings.length > 0 ? '<li>Review and address warnings to improve campaign performance and reduce review time.</li>' : ''}
                            <li>Test your landing page on mobile devices (70%+ of users browse on mobile).</li>
                            <li>Use Google PageSpeed Insights to verify load time is under 3 seconds.</li>
                            <li>Keep documentation for any claims made in your ads (prices, features, availability).</li>
                            ${platformName.includes('Meta') ? '<li>Use Meta\'s Ad Library to see examples of approved housing ads in your region.</li>' : ''}
                            ${platformName.includes('Google') ? '<li>Review Google\'s housing policy documentation and accept the policy terms in Google Ads Manager.</li>' : ''}
                        </ul>
                    </div>
                `;
            }

            // Final approval status
            if (isApproved && results.score >= 90) {
                html += `
                    <div class="info-box" style="background: #f0fdf4; border-color: #16a34a;">
                        <h4 style="color: #16a34a;">üéâ Excellent! Campaign Ready to Launch</h4>
                        <p style="color: #166534; margin-top: 10px;">Your campaign meets compliance requirements and best practices. However, final approval depends on platform review. Monitor your campaign after launch and be ready to make adjustments if requested.</p>
                        <ul style="margin-top: 15px; color: #166534;">
                            <li>Ensure you've declared "Housing" special ad category (Meta)</li>
                            <li>Accept housing policy terms in platform (Google)</li>
                            <li>Monitor account health and respond to any policy notifications</li>
                            <li>Keep records of all ad content and approvals</li>
                        </ul>
                    </div>
                `;
            }

            // Important policy reminders
            html += `
                <div class="info-box" style="margin-top: 30px;">
                    <h4>üìö Important Policy References</h4>
                    <ul>
                        <li><strong>Fair Housing Act:</strong> Prohibits discrimination based on race, color, religion, national origin, sex, disability, and familial status in ALL housing advertising.</li>
                        <li><strong>Meta Special Ad Categories:</strong> Housing ads have restricted targeting - Age: 18-65+, All genders required, Location: Min 15-mile radius (US).</li>
                        <li><strong>Google Housing Policy:</strong> Cannot target by gender, age, parental status, marital status, or ZIP code. HTTPS and privacy policy required.</li>
                        <li><strong>Platform Enforcement:</strong> Violations can result in: Ad rejection, account restrictions, permanent bans, and legal action.</li>
                    </ul>
                </div>
            `;

            resultsDiv.innerHTML = html;
            resultsDiv.classList.add('show');
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    </script>
</body>
</html>